# –≠—Ç–∞–ø 0.5: –ß–µ–∫-–ª–∏—Å—Ç –µ–¥–∏–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (SSO) —Å Clerk

**–¶–µ–ª—å:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –≤—Ö–æ–¥–æ–º –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π Go2Asia.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (Development –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ)

---

## ‚úÖ –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Clerk Application

- [x] **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –≤ Clerk Dashboard**
  - [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "go2asia" —Å–æ–∑–¥–∞–Ω–æ (Free ‚Ä¢ Development)
  - [x] –†–µ–≥–∏–æ–Ω –≤—ã–±—Ä–∞–Ω

- [x] **Satellite domain –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
  - [x] Domain: `go2asia.space` ‚Äî Verified ‚úÖ
  - [x] DNS Configuration –∞–∫—Ç–∏–≤–Ω–∞

- [x] **Email –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞**
  - [x] Sign-up with email ‚Äî –≤–∫–ª—é—á–µ–Ω
  - [x] Sign-in with email ‚Äî –≤–∫–ª—é—á–µ–Ω
  - [x] Email verification code ‚Äî –≤–∫–ª—é—á–µ–Ω
  - [x] Verify at sign-up ‚Äî –≤–∫–ª—é—á–µ–Ω

- [x] **SSO connections –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**
  - [x] Google Social provider ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Used for sign-in, Shared Credentials)

- [x] **Attack Protection –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
  - [x] Lockout Policy ‚Äî –≤–∫–ª—é—á–µ–Ω (100 –ø–æ–ø—ã—Ç–æ–∫, 1 —á–∞—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)
  - [x] Bot sign-up protection ‚Äî –≤–∫–ª—é—á–µ–Ω (Cloudflare Turnstile)
  - [x] User enumeration protection ‚Äî –≤–∫–ª—é—á–µ–Ω (Bulk protection)

- [x] **Sessions –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã**
  - [x] Maximum lifetime ‚Äî 7 –¥–Ω–µ–π (Pro feature)
  - [x] Multi-session handling ‚Äî –≤–∫–ª—é—á–µ–Ω (Add-on)
  - [x] Customize session token ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω (`__session`)

### 2. Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω

- [x] **Webhook endpoint —Å–æ–∑–¥–∞–Ω**
  - [x] URL: `https://go2asia-auth-service-staging.fred89059599296.workers.dev/v1/webhook`
  - [x] –°–æ–∑–¥–∞–Ω: 2 –Ω–æ—è–±—Ä—è 2025 –≥. –≤ 23:09
  - [x] –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 14 –Ω–æ—è–±—Ä—è 2025 –≥. –≤ 21:24
  - [x] –ü–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è: `user.created`, `user.updated`, `user.deleted`
  - [ ] ‚ö†Ô∏è Error Rate: 16.7% (—Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 3. API Keys –∏ Secrets

- [x] **–°–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Cloudflare Workers (staging)**
  - [x] `go2asia-auth-service-staging`:
    - [x] `CLERK_SECRET_KEY` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
    - [x] `CLERK_WEBHOOK_SECRET` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
    - [x] `DATABASE_URL` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
  - [x] `go2asia-token-service-staging`:
    - [x] `CLERK_SECRET_KEY` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
    - [x] `DATABASE_URL` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
  - [x] `go2asia-referral-service-staging`:
    - [x] `CLERK_SECRET_KEY` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω
    - [x] `DATABASE_URL` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω

---

## üîÑ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- [ ] **–†–æ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ Clerk Dashboard**
  - [ ] `spacer` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - [ ] `vip` - VIP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - [ ] `pro-curator` - PRO-–∫—É—Ä–∞—Ç–æ—Ä
  - [ ] `partner` - –ø–∞—Ä—Ç–Ω—ë—Ä
  - [ ] `admin` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

- [ ] **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã**
  - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ custom metadata –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞:
    - [ ] `referral_code` - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥
    - [ ] `referrer_id` - ID –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - [ ] `points_balance` - –±–∞–ª–∞–Ω—Å Points (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è)
    - [ ] `g2a_balance` - –±–∞–ª–∞–Ω—Å G2A Token (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è)
    - [ ] `nft_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ NFT (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è)

### 2. Redirect URIs –¥–ª—è production

- [ ] **Production redirect URIs –¥–æ–±–∞–≤–ª–µ–Ω—ã** (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ)
  - [ ] `https://go2asia.space/*`
  - [ ] `https://www.go2asia.space/*`
  - [ ] `https://api.go2asia.space/*`
  - [ ] `https://auth.go2asia.space/*`

### 3. Webhook endpoint –≤ Auth Service

- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω webhook handler**
  - [ ] Endpoint `/v1/webhook` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ Auth Service
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `user.created` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `user.updated` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `user.deleted` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
  - [ ] Error Rate —Å–Ω–∏–∂–µ–Ω –¥–æ 0%

### 4. Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- [ ] **–°–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ production Workers** (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ)
  - [ ] `go2asia-auth-service`:
    - [ ] `CLERK_SECRET_KEY` (production)
    - [ ] `CLERK_WEBHOOK_SECRET` (production)
  - [ ] `go2asia-token-service`:
    - [ ] `CLERK_SECRET_KEY` (production)
  - [ ] `go2asia-referral-service`:
    - [ ] `CLERK_SECRET_KEY` (production)

### 5. Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω)

- [ ] **Clerk SDK —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**
  - [ ] `@clerk/nextjs` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PWA Shell
  - [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

- [ ] **Middleware —Å–æ–∑–¥–∞–Ω**
  - [ ] `middleware.ts` —Å–æ–∑–¥–∞–Ω —Å –∑–∞—â–∏—Ç–æ–π routes
  - [ ] –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
  - [ ] –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

- [ ] **Auth pages —Å–æ–∑–¥–∞–Ω—ã**
  - [ ] `/sign-in` —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞
  - [ ] `/sign-up` —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Clerk Dashboard:
- [x] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
- [x] Satellite domain `go2asia.space` –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- [x] Webhook endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] ‚ö†Ô∏è Error Rate webhook: 16.7% (—Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- [ ] –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Å–æ–∑–¥–∞–Ω—ã

### Backend:
- [x] Auth Service Worker –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ `go2asia-auth-service-staging.fred89059599296.workers.dev`
- [ ] ‚ö†Ô∏è Webhook endpoint `/v1/webhook` —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ
- [x] –°–µ–∫—Ä–µ—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ staging Workers

### SSO –º–µ–∂–¥—É –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏:
- [x] Satellite domain –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `go2asia.space`
- [x] Cookies –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–∂–¥—É –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏ (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏)

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å–µ–π—á–∞—Å ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook handler –≤ Auth Service
- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–∑–∂–µ, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–æ–ª–µ–π
- Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ production –¥–µ–ø–ª–æ—é

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook handler `/v1/webhook` –≤ Auth Service
   - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å Error Rate webhook (—Å–Ω–∏–∑–∏—Ç—å –¥–æ 0%)

2. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - [ ] –°–æ–∑–¥–∞—Ç—å —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Clerk Dashboard
   - [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
   - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production redirect URIs (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ production Workers (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ)

---

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ß–∞—Å—Ç–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ  
**–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:** 2025-12-12  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-12

