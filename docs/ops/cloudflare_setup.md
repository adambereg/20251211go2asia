# Cloudflare Setup ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Go2Asia

Cloudflare –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ç—Ä–∞—Ñ–∏–∫–∞ Go2Asia, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:
- –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤,
- –∑–∞—â–∏—Ç—É –æ—Ç –∞—Ç–∞–∫ –∏ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞,
- SSL/TLS-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ,
- —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS,
- —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞,
- —É–ª—É—á—à–µ–Ω–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ (–†–æ—Å—Å–∏—è, –í—å–µ—Ç–Ω–∞–º, –¢–∞–∏–ª–∞–Ω–¥ –∏ –¥—Ä.).

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Cloudflare –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Go2Asia.

---

# 1. –†–æ–ª—å Cloudflare –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Go2Asia

Cloudflare —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Cloudflare ‚Üí Netlify (Frontend)
                     ‚Üì
                  API Gateway (Cloudflare Workers or Backend Origin)
                     ‚Üì
               Backend Microservices

–ß–µ—Ä–µ–∑ Cloudflare –ø—Ä–æ—Ö–æ–¥—è—Ç:

- –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω `go2asia.space`,
- production, staging –∏ preview-–¥–µ–ø–ª–æ–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞,
- API-—Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ Cloudflare Workers (API Gateway –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã),
- —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã,
- –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç —á–µ—Ä–µ–∑ Cloudflare R2,
- –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ —É–≥—Ä–æ–∑.

---

# 2. DNS-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## 2.1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ DNS

- –í—Å–µ DNS-–∑–∞–ø–∏—Å–∏ **–¥–æ–ª–∂–Ω—ã** –±—ã—Ç—å —É–ø—Ä–∞–≤–ª—è–µ–º—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Cloudflare.
- –í–∫–ª—é—á—ë–Ω **orange cloud** (–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ) –¥–ª—è:
  - `go2asia.space`,
  - `www.go2asia.space`,
  - `api.go2asia.space`,
  - `staging.go2asia.space`,
  - `staging-api.go2asia.space`.

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- WAF,
- –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ,
- –∑–∞—â–∏—Ç—É –æ—Ç DDoS,
- —Å–∫—Ä—ã—Ç–∏–µ IP-–∞–¥—Ä–µ—Å–æ–≤ origin-—Å–µ—Ä–≤–µ—Ä–æ–≤.

## 2.2. –ü—Ä–∏–º–µ—Ä—ã DNS-–∑–∞–ø–∏—Å–µ–π

| –ü–æ–¥–¥–æ–º–µ–Ω | –¢–∏–ø | –ó–Ω–∞—á–µ–Ω–∏–µ | Proxy | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-----|----------|--------|------------|
| go2asia.space | CNAME | `go2asia-pwa-shell.netlify.app` | üüß | –ø—Ä–æ–¥-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ |
| www.go2asia.space | CNAME | `go2asia.space` | üüß | —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω |
| staging.go2asia.space | CNAME | `staging-go2asia-pwa-shell.netlify.app` | üüß | staging —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ |
| api.go2asia.space | CNAME | `go2asia-api-gateway.workers.dev` | üüß | production API Gateway |
| staging-api.go2asia.space | CNAME | `go2asia-api-gateway-staging.workers.dev` | üüß | staging API Gateway |

---

# 3. SSL/TLS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## 3.1. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º: **Full (strict)**

–ü—Ä–∏—á–∏–Ω—ã:
- –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å,
- –∑–∞—â–∏—Ç–∞ –æ—Ç MITM,
- –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–∞—á–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã origin.

## 3.2. Always Use HTTPS

- –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ.
- HTTP-–∑–∞–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ HTTPS.

## 3.3. HSTS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- –≤–∫–ª—é—á–∏—Ç—å HSTS,
- —Å—Ä–æ–∫ ‚Äî –Ω–µ –º–µ–Ω–µ–µ 6 –º–µ—Å—è—Ü–µ–≤,
- –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥–¥–æ–º–µ–Ω—ã.

**–í–∞–∂–Ω–æ:**  
–≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!

---

# 4. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Caching)

Cloudflare –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É Go2Asia.

## 4.1. –ß—Ç–æ –∫–µ—à–∏—Ä—É–µ–º?

- —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (JS, CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è),
- –ø—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å—Ç—Ä–∞–Ω–∏—Ü—ã Atlas/Blog/Events –¥–ª—è –≥–æ—Å—Ç–µ–π),
- –æ—Ç–≤–µ—Ç—ã Netlify –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

## 4.2. –ß—Ç–æ –ù–ï –∫–µ—à–∏—Ä—É–µ–º?

- API –∑–∞–ø—Ä–æ—Å—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∂–∏–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
- –∑–∞–ø—Ä–æ—Å—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏,
- –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## 4.3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Caching Level:

- **Standard** –∏–ª–∏ **Caching Everything** (–¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏),
- –¥–ª—è PWA shell –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Edge Cache TTL = 1 —á–∞—Å**,  
  –ø—Ä–∏ —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª—è—Ç—å —Å—Ç–∞—Ç–∏–∫—É –ø–æ —Ö—ç—à–∞–º (Netlify –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

---

# 5. Page Rules / Rulesets

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:

- –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö URL,
- —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `www ‚Üí root domain`),
- —É—Å–∏–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ API.

## –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª:

1. `*go2asia.space/_next/static/*`  
   Cache Level: Cache Everything  
   Edge TTL: 1 –º–µ—Å—è—Ü  

2. `*go2asia.space/api/*`  
   Cache Level: Bypass  
   Security Level: High  

3. `www.go2asia.space/*`  
   Forwarding URL ‚Üí https://go2asia.space/$1

---

# 6. WAF (Web Application Firewall)

Cloudflare WAF –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É:

- –æ—Ç SQL Injection,
- –æ—Ç XSS,
- –æ—Ç –±–æ—Ç–æ–≤ –∏ —Å–∫–∞–Ω–µ—Ä–æ–≤,
- –æ—Ç –ø–æ–ø—ã—Ç–æ–∫ –≤–∑–ª–æ–º–∞ API.

## 6.1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Go2Asia

- –≤–∫–ª—é—á–∏—Ç—å OWASP Core Ruleset,
- –≤–∫–ª—é—á–∏—Ç—å ¬´Bot Fight Mode¬ª (–µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å SEO),
- –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoint‚Äô–æ–≤:
  - `/api/auth/*`,
  - `/api/payments/*`,
  - `/api/referral/*`.

## 6.2. –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è—Ö

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º ¬´Log¬ª –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –≤–∫–ª—é—á–µ–Ω–∏–µ–º ¬´Block¬ª.
- –î–æ–±–∞–≤–ª—è—Ç—å —Ç–æ—á–µ—á–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ –ø—É—Ç–∏/–º–µ—Ç–æ–¥—É/IP.

---

# 7. Rate Limiting (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è API)

–î–ª—è –∑–∞—â–∏—Ç—ã API Go2Asia –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –∏ —Ñ–ª—É–¥-–∞—Ç–∞–∫:

| Endpoint | –õ–∏–º–∏—Ç | –ò–Ω—Ç–µ—Ä–≤–∞–ª |
|----------|--------|-----------|
| `/api/auth/login` | 5 | 1 –º–∏–Ω—É—Ç–∞ |
| `/api/auth/send-code` | 3 | 5 –º–∏–Ω—É—Ç |
| –ø–æ–∏—Å–∫ `/api/places/search` | 20 | 1 –º–∏–Ω—É—Ç–∞ |
| `/api/events` | 60 | 1 –º–∏–Ω—É—Ç–∞ |

---

# 8. Cloudflare Zero Trust (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–ø—É–±–ª–∏—á–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö):

- –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏,
- dev-–∏–Ω—Å—Ç–∞–Ω—Å—ã,
- dashboard –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.

Cloudflare Access –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ OAuth (Google/VK),
- –ø—Ä–æ–≤–µ—Ä—è—Ç—å IP,
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã.

---

# 9. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –†–§-–∞—É–¥–∏—Ç–æ—Ä–∏–µ–π

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –º–æ–≥—É—Ç –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏:

- –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å IP Cloudflare,
- —Å–Ω–∏–∂–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å CDN,
- –¥–∞–≤–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### 9.1. –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –†–§-—Ç—Ä–∞—Ñ–∏–∫–∞  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∏:
- Selectel,
- G-Core,
- VPS –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö –†–§.

### 9.2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å fallback-–¥–æ–º–µ–Ω–∞  
–ù–∞ –±—É–¥—É—â–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ:
- –≤—ã–¥–µ–ª–∏—Ç—å –¥–æ–º–µ–Ω –±–µ–∑ Cloudflare-–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è,
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç.

### 9.3. –£—Å–∏–ª–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü  
–û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è:
- Atlas,
- Pulse,
- Blog,
- RF-–∫–∞—Ç–∞–ª–æ–≥–∞.

---

# 10. –õ–æ–≥–∏ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

Cloudflare –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

- Analytics,
- Security Insights,
- Caching Reports.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á—ë—Ç–æ–≤,
- –∞–Ω–∞–ª–∏–∑ DDoS/–±–æ—Ç-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏,
- –≤–∫–ª—é—á–µ–Ω–∏–µ email-alerts –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö.

---

# 11. –ß–µ–∫-–ª–∏—Å—Ç Cloudflare Setup

### DNS  
- [ ] –í—Å–µ –∑–∞–ø–∏—Å–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ Cloudflare  
- [ ] –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (üüß)  
- [ ] Staging –∏ API –ø–æ–¥–¥–æ–º–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã  

### SSL/TLS  
- [ ] Full (strict)  
- [ ] Always Use HTTPS  
- [ ] HSTS –≤–∫–ª—é—á—ë–Ω (–µ—Å–ª–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ)  

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ  
- [ ] –°—Ç–∞—Ç–∏–∫–∞ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è  
- [ ] API –Ω–µ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è  
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è `_next/static/*`  

### WAF  
- [ ] OWASP –≤–∫–ª—é—á—ë–Ω  
- [ ] Bot Fight Mode –≤–∫–ª—é—á–µ–Ω  
- [ ] –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è auth/payment endpoint'–æ–≤  

### Rate Limiting  
- [ ] –õ–∏–º–∏—Ç—ã –Ω–∞ login, search, events  

### –†–§-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞  
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  
- [ ] Fallback-–ø–ª–∞–Ω (–Ω–∞ –±—É–¥—É—â–µ–µ)  

---

# 12. –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `netlify_setup.md`
- `ci_cd.md`
- `environments.md`
- `monitoring.md`
- `logging.md`
- `../../architecture/api_architecture.md`

---

## 13. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Cloudflare

‚ö†Ô∏è –í–∞–∂–Ω–æ: –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Cloudflare –¥–ª—è Go2Asia **—É–∂–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã.  
–ù–æ–≤—ã–π –∫–æ–¥ –∏ –Ω–æ–≤—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–æ–ª–∂–Ω—ã **–ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ—Å—É—Ä—Å–∞–º**, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ.

### 13.1. –£–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

- **–ê–∫–∫–∞—É–Ω—Ç Cloudflare**  
  - Account ID: —Å–º. Cloudflare Dashboard (—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ GitHub Secrets –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `CLOUDFLARE_ACCOUNT_ID`)

- **Workers (staging)**  
  - `go2asia-api-gateway-staging`
  - `go2asia-auth-service-staging`
  - `go2asia-content-service-staging`
  - `go2asia-referral-service-staging`
  - `go2asia-token-service-staging`

- **DNS-–∑–æ–Ω–∞: `go2asia.space`**  
  –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã CNAME-–∑–∞–ø–∏—Å–∏ (–ø—Ä–∏–º–µ—Ä–Ω—ã–π –Ω–∞–±–æ—Ä):
  - `api.go2asia.space` ‚Üí `api-gateway.go2asia.workers.dev`
  - `auth.go2asia.space` ‚Üí `auth-service.go2asia.workers.dev`
  - `content.go2asia.space` ‚Üí `content-service.go2asia.workers.dev`
  - `token.go2asia.space` ‚Üí `token-service.go2asia.workers.dev`
  - `rf-api.go2asia.space` ‚Üí `rf-api.go2asia.workers.dev`
  - –∏ –¥—Ä. —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã (—Å–º. —Ä–µ–∞–ª—å–Ω—É—é –∑–æ–Ω—É DNS –≤ Cloudflare).

- **R2 Object Storage**
  - Bucket: `go2asia-media`
  - –¢–∏–ø–æ–≤—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã: `country/`, `city/`, `place/`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ (—Å—Ç—Ä–∞–Ω—ã, –≥–æ—Ä–æ–¥–∞, –º–µ—Å—Ç–∞ –∏ —Ç.–ø.).

---

## 14. Cloudflare R2 –¥–ª—è –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞

Cloudflare R2 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω, –≥–æ—Ä–æ–¥–æ–≤, –º–µ—Å—Ç, —Å–æ–±—ã—Ç–∏–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞–≤–∞—Ç–∞—Ä—ã –∏ —Ç.–¥.).

### 14.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ R2 Bucket

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π bucket:** `go2asia-media`

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π bucket:

1. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Cloudflare Dashboard ‚Üí R2 ‚Üí Create bucket**
2. –ò–º—è: `go2asia-media`
3. Location: –≤—ã–±—Ä–∞—Ç—å –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–≥–∏–æ–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è EU –¥–ª—è –†–§-–∞—É–¥–∏—Ç–æ—Ä–∏–∏)
4. Public access: –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ Custom Domain –∏–ª–∏ Public URL (—Å–º. –Ω–∏–∂–µ)

### 14.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤:

```
go2asia-media/
‚îú‚îÄ‚îÄ country/          # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω
‚îÇ   ‚îú‚îÄ‚îÄ {country-id}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ flag.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ banner.jpg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gallery/
‚îú‚îÄ‚îÄ city/             # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ {city-id}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ banner.jpg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gallery/
‚îú‚îÄ‚îÄ place/            # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Å—Ç
‚îÇ   ‚îú‚îÄ‚îÄ {place-id}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cover.jpg
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ gallery/
‚îú‚îÄ‚îÄ event/            # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ {event-id}/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ poster.jpg
‚îú‚îÄ‚îÄ user/             # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ avatar/
‚îÇ   ‚îî‚îÄ‚îÄ uploads/
‚îî‚îÄ‚îÄ blog/             # –ú–µ–¥–∏–∞ –¥–ª—è –±–ª–æ–≥–∞
    ‚îî‚îÄ‚îÄ {article-slug}/
```

### 14.3. –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Custom Domain

–î–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ `media.go2asia.space`:

1. **–°–æ–∑–¥–∞—Ç—å Custom Domain –≤ R2:**
   - R2 ‚Üí `go2asia-media` ‚Üí Settings ‚Üí Custom Domain
   - –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω: `media.go2asia.space`

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS:**
   - –î–æ–±–∞–≤–∏—Ç—å CNAME –∑–∞–ø–∏—Å—å –≤ Cloudflare DNS:
     - –ò–º—è: `media`
     - –¶–µ–ª—å: R2 Custom Domain (–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö R2)
     - Proxy: üüß (–≤–∫–ª—é—á–µ–Ω–æ)

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞):**
   ```json
   [
     {
       "AllowedOrigins": ["https://go2asia.space", "https://staging.go2asia.space"],
       "AllowedMethods": ["GET", "HEAD"],
       "AllowedHeaders": ["*"],
       "MaxAgeSeconds": 3600
     }
   ]
   ```

### 14.4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

**–ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –≤ R2 —á–µ—Ä–µ–∑ Worker:**

```typescript
import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';

const R2_ACCOUNT_ID = env.CLOUDFLARE_ACCOUNT_ID;
const R2_ACCESS_KEY_ID = env.R2_ACCESS_KEY_ID;
const R2_SECRET_ACCESS_KEY = env.R2_SECRET_ACCESS_KEY;
const R2_BUCKET = 'go2asia-media';

const s3Client = new S3Client({
  region: 'auto',
  endpoint: `https://${R2_ACCOUNT_ID}.r2.cloudflarestorage.com`,
  credentials: {
    accessKeyId: R2_ACCESS_KEY_ID,
    secretAccessKey: R2_SECRET_ACCESS_KEY,
  },
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
await s3Client.send(
  new PutObjectCommand({
    Bucket: R2_BUCKET,
    Key: `place/${placeId}/cover.jpg`,
    Body: fileBuffer,
    ContentType: 'image/jpeg',
  })
);
```

**–ü—É–±–ª–∏—á–Ω—ã–π URL:**
```
https://media.go2asia.space/place/{placeId}/cover.jpg
```

### 14.5. R2 Secrets –¥–ª—è GitHub Actions

–î–æ–±–∞–≤–∏—Ç—å –≤ GitHub Secrets (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∏–∑ CI/CD):

- `R2_ACCESS_KEY_ID` - Access Key ID –∏–∑ Cloudflare R2
- `R2_SECRET_ACCESS_KEY` - Secret Access Key –∏–∑ Cloudflare R2

**–ü–æ–ª—É—á–∏—Ç—å:**
- Cloudflare Dashboard ‚Üí R2 ‚Üí Manage R2 API Tokens ‚Üí Create API Token

---

## 15. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Cloudflare Workers

### 15.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Workers –≤ –ø—Ä–æ–µ–∫—Ç–µ

Workers —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –º–æ–Ω–æ—Ä–µ–ø–æ:

```
services/
‚îú‚îÄ‚îÄ api-gateway/          # API Gateway Worker
‚îú‚îÄ‚îÄ auth-service/         # Auth Service Worker
‚îú‚îÄ‚îÄ content-service/     # Content Service Worker
‚îú‚îÄ‚îÄ referral-service/    # Referral Service Worker
‚îú‚îÄ‚îÄ token-service/       # Token Service Worker
‚îî‚îÄ‚îÄ ...
```

### 15.2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Worker (—à–∞–±–ª–æ–Ω)

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ Worker –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Wrangler CLI:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Wrangler (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
pnpm add -D wrangler

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ Worker
cd services/new-service
npx wrangler init
```

**–ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `wrangler.toml`:**

```toml
name = "go2asia-new-service-staging"
main = "src/index.ts"
compatibility_date = "2024-01-01"

[env.production]
name = "go2asia-new-service"

[env.staging]
name = "go2asia-new-service-staging"

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
[vars]
ENVIRONMENT = "staging"

# Secrets (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ wrangler secret put)
# CLOUDFLARE_ACCOUNT_ID - –∏–∑ GitHub Secrets
# DATABASE_URL - –∏–∑ GitHub Secrets

# R2 bindings (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ R2)
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "go2asia-media"
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π `src/index.ts`:**

```typescript
export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {
    return new Response('Hello from Go2Asia Service!', {
      headers: { 'content-type': 'text/plain' },
    });
  },
};

interface Env {
  ENVIRONMENT: string;
  // –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
}
```

### 15.3. –î–µ–ø–ª–æ–π Worker

**–õ–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):**
```bash
npx wrangler deploy --env staging
```

**–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions:**
Workers –¥–µ–ø–ª–æ—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GitHub Actions workflows (—Å–º. `.github/workflows/staging.yml` –∏ `production.yml`).

### 15.4. –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Workers

**Staging:**
- `go2asia-api-gateway-staging`
- `go2asia-auth-service-staging`
- `go2asia-content-service-staging`
- `go2asia-referral-service-staging`
- `go2asia-token-service-staging`

**Production:**
- `go2asia-api-gateway`
- `go2asia-auth-service`
- `go2asia-content-service`
- `go2asia-referral-service`
- `go2asia-token-service`

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–º–µ–Ω–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤ ADR.

### 13.2. –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ CI/CD

1. **–ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ Workers —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏**, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ –≤ ADR.
2. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞:
   - –¥–µ–ø–ª–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`go2asia-*-service-staging`),
   - GitHub Actions –¥–æ–ª–∂–Ω—ã —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–∏ –∏–º–µ–Ω–∞, –∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ.
3. –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å R2:
   - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π bucket `go2asia-media`,
   - –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∞–∫–µ—Ç—ã –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
4. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Cloudflare (–Ω–æ–≤—ã–µ Workers, DNS, R2) –¥–æ–ª–∂–Ω—ã:
   - –æ–±—Å—É–∂–¥–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ ADR (`docs/decisions/*.md`),
   - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ (`cloudflare_setup.md`) –∏ `docs/ops/environments.md`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–æ–≤—ã–π –∫–æ–¥ ¬´–ø—Ä–∏–µ–∑–∂–∞–µ—Ç¬ª –≤ —É–∂–µ –≥–æ—Ç–æ–≤—É—é Cloudflare-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –Ω–µ –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS, Workers –∏ R2.
