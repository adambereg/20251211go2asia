# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≠—Ç–∞–ø—É 0.6: –ö–∞—Ä–∫–∞—Å PWA-–æ–±–æ–ª–æ—á–∫–∏ –∏ –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–µ—Ç –Ω–∞—á–∞–ª–∞  
**–î–∞—Ç–∞:** 2025-12-12

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç

**Phase 0.5 –∑–∞–≤–µ—Ä—à—ë–Ω:**
- ‚úÖ –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ Clerk Dashboard
- ‚úÖ Customize Session Token –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å claim `role`
- ‚úÖ –†–æ–ª—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —á–µ—Ä–µ–∑ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

**–í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- `capsules/**` ‚Äî read-only, –∑–∞–ø—Ä–µ—â–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—Ä–æ–Ω—Ç–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≤ `apps/**`
- –ö–∞–ø—Å—É–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–µ—à–µ–Ω–∏–π

---

## üéØ –¶–µ–ª—å Phase 0.6

–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π App Shell ‚Äì –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö PWA-–º–æ–¥—É–ª–µ–π.

---

## üì¶ –ó–∞–¥–∞—á–∏ Phase 0.6

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–æ–µ–≤–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ `apps/go2asia-pwa-shell`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
apps/
‚îî‚îÄ‚îÄ go2asia-pwa-shell/
    ‚îú‚îÄ‚îÄ app/                    # Next.js 15 App Router
    ‚îú‚îÄ‚îÄ components/             # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ lib/                    # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
    ‚îú‚îÄ‚îÄ middleware.ts           # Clerk middleware —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π
    ‚îú‚îÄ‚îÄ package.json
    ‚îî‚îÄ‚îÄ ...
```

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Next.js 15 (App Router)
- React 18
- TypeScript
- Tailwind CSS
- Clerk SDK (`@clerk/nextjs`)
- Turborepo workspace

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Clerk:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `.env.local` —Å Clerk –∫–ª—é—á–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ClerkProvider –≤ layout
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å middleware —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ä–æ–ª–µ–π –∏–∑ `sessionClaims.role`
- –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã sign-in/sign-up

### 2. App Shell ‚Äî –±–∞–∑–æ–≤—ã–π –∫–∞—Ä–∫–∞—Å

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **Mobile:**
  - Header (–ø–æ–∏—Å–∫ + –ª–æ–≥–æ—Ç–∏–ø)
  - Bottom Navigation (5 –∏–∫–æ–Ω–æ–∫)
  - Content area
  - Floating Actions (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

- **Desktop:**
  - Left Sidebar Navigation
  - Top Header
  - Content (–¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω—ã–π –∏–ª–∏ —Ç—Ä—ë—Ö)
  - Right Utility Panel (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ù–∞–≤–∏–≥–∞—Ü–∏—è:**
1. Guru Nearby
2. Atlas
3. Pulse Events
4. Blog
5. Profile

### 3. PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **Manifest:** `manifest.webmanifest` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Service Worker:** –±–∞–∑–æ–≤—ã–π Service Worker —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (Workbox)
- **Offline —Ä–µ–∂–∏–º:** –∑–∞–≥–ª—É—à–∫–∞ "Offline" –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
- **Mobile-first:** –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π UI –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### 4. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ–¥ –º–∏–∫—Ä–æ—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—ã

**URL —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- `/atlas` ‚Äî Atlas Asia –º–æ–¥—É–ª—å
- `/pulse` ‚Äî Pulse Asia –º–æ–¥—É–ª—å
- `/blog` ‚Äî Blog Asia –º–æ–¥—É–ª—å
- `/guru` ‚Äî Guru Nearby –º–æ–¥—É–ª—å
- `/rf` ‚Äî Russian Friendly –º–æ–¥—É–ª—å
- `/rielt` ‚Äî Rielt.Market –º–æ–¥—É–ª—å
- `/space` ‚Äî Space –º–æ–¥—É–ª—å
- `/quest` ‚Äî Quest Asia –º–æ–¥—É–ª—å
- `/connect` ‚Äî Connect –º–æ–¥—É–ª—å

**–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π —á–µ—Ä–µ–∑ `next/dynamic`
- Code splitting –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ Module Federation (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)

### 5. State Management

**Shell —Ö—Ä–∞–Ω–∏—Ç:**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (—á–µ—Ä–µ–∑ Clerk)
- –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ `sessionClaims.role`)

**–ú–æ–¥—É–ª–∏:**
- –ù–µ –¥—É–±–ª–∏—Ä—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ Shell
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π API –∫–ª–∏–µ–Ω—Ç
- –ò–º–µ—é—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ slice-—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phase 0.5

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π –≤ –±–æ–µ–≤–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

**Middleware (`middleware.ts`):**
```typescript
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';
import { NextResponse } from 'next/server';

const isAdminRoute = createRouteMatcher(['/admin(.*)']);
const isPRORoute = createRouteMatcher(['/rf/pro(.*)', '/quest/pro(.*)']);

export default clerkMiddleware(async (auth, req) => {
  const { userId, sessionClaims } = await auth();
  
  // –†–æ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ sessionClaims.role –±–ª–∞–≥–æ–¥–∞—Ä—è Customize Session Token
  const role = (sessionClaims?.role as string) || 'spacer';
  
  if (isAdminRoute(req) && role !== 'admin') {
    return NextResponse.redirect(new URL('/', req.url));
  }
  
  if (isPRORoute(req) && role !== 'pro-curator' && role !== 'admin') {
    return NextResponse.redirect(new URL('/', req.url));
  }
  
  return NextResponse.next();
});
```

**Hooks –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏:**
```typescript
// hooks/useRole.ts
import { useAuth } from '@clerk/nextjs';

export function useRole() {
  const { sessionClaims } = useAuth();
  return (sessionClaims?.role as string) || 'spacer';
}
```

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–µ—à–µ–Ω–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –ø—Ä–æ—Ç–æ—Ç–∏–ø:**
- `capsules/frontend-shell/apps/go2asia-pwa-shell/` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∏–¥–µ–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–∑ –∫–∞–ø—Å—É–ª—ã
- UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –±–æ–µ–≤–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)

**–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü—Ä—è–º–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ –∫–∞–ø—Å—É–ª—ã
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞–ø—Å—É–ª—ã

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 0.6

- [ ] –ë–æ–µ–≤–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–∑–¥–∞–Ω –≤ `apps/go2asia-pwa-shell`
- [ ] Clerk –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–æ–ª–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `sessionClaims.role` –≤ middleware
- [ ] App Shell —Å –±–∞–∑–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (manifest, service worker) –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –º–æ–¥—É–ª–µ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã (–∑–∞–≥–ª—É—à–∫–∏)
- [ ] Mobile-first –¥–∏–∑–∞–π–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] Offline —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîÑ –°–≤—è–∑—å —Å Phase 0.7

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Phase 0.6:

- **Phase 0.7:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Netlify –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ production –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - Security headers –∏ CSP
  - Environment variables –¥–ª—è production

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-12  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-12

